digraph G {
  rankdir=LR;
  node [shape=box, style=rounded, fontname="Arial"];
  subgraph cluster_core0 {
    label="Core0";
    color="#6ca0dc";
    ui [label="app_task_core0\nUI loop\nkeys/modes\nwaterfall flush\nRTC/countdown"];
    sys [label="BLE host (NimBLE)\nUSB CDC/JTAG\nNVS/time services"];
  }
  subgraph cluster_core1 {
    label="Core1";
    color="#d38b5d";
    stream [label="stream_wav_task / mic stream\npush waterfall rows"];
    decode [label="FT8 decode/FFT/DSP"];
  }
  shared [shape=folder, label="Shared state\nTX/RX queues\nwaterfall buffer\ncountdown/RTC"];
  ui -> stream [label="start on 'x' when idle"];
  stream -> decode [label="audio blocks"];
  stream -> shared [label="waterfall rows (dirty flag)"];
  decode -> shared [label="RX lines\ncandidates"];
  shared -> ui [label="draw RX/waterfall\nmenus/status"];
}
